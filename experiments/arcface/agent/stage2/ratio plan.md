좋아, 핵심만 딱 잡아서 “간단하고 쉽게” 실험 설계를 정리해줄게.
(전제: `stage2_baseline.ipynb` 사용, 모델은 DSMIL 고정, 윈도우/배그 구조 등 기존 설정 그대로.)

# 1) 무엇을 바꿀까? — 딱 하나: **위조 비율**

* 바꾸는 것: **양성(Bag=1)** 생성 시 섞을 **위조 비율** = 5%, 10%, 20%, 30%.
* 나머지(음성 생성법, 윈도우 길이, 배그 크기, 특징, 학습 파라미터)는 전부 **고정**.

# 2) 데이터 만들기(Stage2) — 두 가지 프로토콜

## A. 일치 비율(Matched) 프로토콜

* **Train/Val/Test 모두 같은 비율**로 위조 생성.
* 목적: “그 비율에 최적화된” 모델 성능을 순수 비교.
* 실행: 각 비율마다 **별도의 데이터셋·별도의 학습**을 4회 진행.

  * 예) Train(5%)–Val(5%)–Test(5%), …, Train(30%)–Val(30%)–Test(30%)

## B. 분포 변화(Shift) 프로토콜

* **Train은 30%로 고정**, Val/Test만 비율을 바꿈.
* 목적: 30%에 학습된 모델이 \*\*낮은 위조 비율(5%, 10%)\*\*에서 얼마나 민감하게 잡는지 확인.
* 실행: Train(30%)–Val/Test(5/10/20/30%)로 **하나의 모델**을 평가.

# 3) 임계값(Threshold) 잡는 법 — 두 가지 보기

* **실전형(고정 임계값)**: Val(30%)에서 찾은 임계값을 **그대로** 모든 Test(5/10/20/30%)에 적용.
  → 실제 배포 시 “한 번 정하면 계속 쓰는” 느낌.
* **상한선형(비율별 최적화)**: 각 Test 비율에 **동일 비율의 Val**로 임계값을 따로 최적화.
  → 조건을 맞춰 \*\*최대 성능(상한선)\*\*을 보는 느낌.

# 4) 평가 지표(간단)

* **AUC, F1, Precision, Recall** 모두 기록.
* 초점: **Recall(재현율)** — 위조 비율이 낮아질수록 얼마나 떨어지는지 보는 게 핵심.

# 5) 로그/이름 규칙(헷갈리지 않게)

* 데이터셋 폴더명 예시:

  * `bags_baseline_ratio05/`, `bags_baseline_ratio10/`, `...ratio30/`
* 결과 저장명 예시:

  * `dsmil_matched_ratio05.json`, `dsmil_shift_train30_test10.json` 등

# 6) 실행 순서(진짜 간단 버전)

1. **Stage2 생성**: 각 비율(5/10/20/30)로 양성 데이터 만들기(음성은 기존과 동일).
2. **학습**:

   * Matched: 비율별 4개 모델 학습.
   * Shift: Train(30%) 1개 모델 학습.
3. **검증/임계값**: 위 3번의 두 방식 중 선택(실전형 vs 상한선형).
4. **테스트**: 모든 비율에서 AUC/F1/Precision/**Recall** 수치 정리.
5. **정리**: 비율별 성능 곡선(특히 Recall) 간단 그래프/표로 비교.

# 7) 아주 작은 팁(빼먹기 쉬운 포인트)

* **시드 고정**: 비율만 바꿨을 때도 비교가 공정해짐.
* **데이터 크기 맞추기**: 비율별 Train/Val/Test **샘플 수를 동일**하게.
* **섞는 방식**: `stage2_baseline`은 인스턴스 안에 두 작성자가 섞일 수 있음(설계 유지).

  * 낮은 비율(5%, 10%)에서 **완전 랜덤 산포**만 쓰면 신호가 너무 약해질 수 있으니,
    현실감 살피려면 “산포” 기본 + **아주 짧은 연속 블록 1개** 정도만 추가하는 것도 괜찮음(선택).

---

## 한 페이지 요약(어떻게 돌릴지)

* **Matched 4회**:

  * (5/5/5), (10/10/10), (20/20/20), (30/30/30)
* **Shift 1회 학습 + 4회 테스트**:

  * 학습: (30/30/30)
  * 테스트: (30/5), (30/10), (30/20), (30/30)
* **임계값**: 실전형(30%에서 고정) + 상한선형(비율별 최적화) **둘 다** 보고 의미 비교.
* **읽는 포인트**: 낮은 비율에서 **Recall이 얼마나 버티는지**가 핵심.

이렇게만 따라가면, 실험이 깔끔하게 정리되고 “낮은 위조 비율에서 DSMIL이 어디까지 잡아내는지”를 한눈에 비교할 수 있어요.
