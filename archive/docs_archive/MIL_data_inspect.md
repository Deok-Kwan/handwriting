# csafe_version5_xai_train 데이터 분석 보고서

## 📊 데이터 구조 및 생성 과정

### 1. **원본 데이터 → 처리된 데이터 변환 과정**
```
원본: w{작성자ID}_s{세션}_p{텍스트유형}_r{반복}.png
     ↓ (EasyOCR 텍스트 검출)
처리: {검출된_텍스트}_{반복번호}.png
```

### 2. **데이터 생성 파이프라인**
1. **원본 필적 이미지**에서 EasyOCR로 텍스트 영역 검출
2. **신뢰도 20% 이상**의 영역만 추출
3. **영어 알파벳 포함** 텍스트만 필터링
4. **단어 단위로 크롭**하여 개별 이미지로 저장
5. **파일명은 OCR 인식 텍스트**로 명명

### 3. **데이터 통계**
- **작성자 수**: 300명 (0-299)
- **전체 이미지**: 351,311개
- **평균 이미지/작성자**: 1,171개
- **반복 번호**: 1-27 (세션별로 다른 분포)
  - 반복 1-18: 약 50-67개/반복 (세션 1, 2)
  - 반복 19-27: 약 12-13개/반복 (세션 3)

## 🎯 MIL 연구 적합성 평가

### ✅ **장점**

1. **풍부한 Instance 수**
   - 작성자당 평균 1,171개의 단어 이미지
   - MIL의 Bag 구성에 충분한 Instance 확보
   
2. **자연스러운 계층 구조**
   - 문서(반복) → Bag
   - 단어 이미지 → Instance
   - 복수 필체 문서 시뮬레이션에 적합

3. **다양한 텍스트 콘텐츠**
   - 3가지 텍스트 유형 (WOZ, LND, PHR)
   - 다양한 단어와 필기 스타일

4. **일관된 작성자 레이블**
   - 300명의 명확한 작성자 구분
   - 충분한 훈련/검증/테스트 분할 가능

### ⚠️ **한계점**

1. **단어 단위 분할의 문제**
   - 문맥 정보 손실
   - 문장 수준 필기 특징 누락
   - 연결된 필기체 패턴 파괴

2. **OCR 오류 영향**
   - 파일명이 OCR 결과에 의존
   - 동일 단어의 다른 인식 결과 발생
   - 예: "Berlin", "Beilin", "Berlan" 등

3. **불균형한 반복 분포**
   - 세션 3 데이터가 상대적으로 적음
   - Bag 크기의 불균형 가능성

4. **원본 문서 구조 손실**
   - 단어 위치 정보 없음
   - 문서 내 배치 패턴 손실

## 💡 MIL 실험을 위한 권장사항

### 1. **Bag 정의 개선**
```python
# 현재: 반복(문서) 단위 Bag
# 개선: 다양한 Bag 구성 실험
- 텍스트 유형별 Bag
- 세션별 Bag
- 시간적 순서를 고려한 Bag
```

### 2. **Instance 필터링**
```python
# OCR 신뢰도 기반 필터링
# 최소 글자 수 기준 적용
# 중복 제거 (유사 이미지)
```

### 3. **데이터 증강**
```python
# 회전, 스케일 변환
# 노이즈 추가
# 필기 스타일 변형
```

### 4. **하이브리드 접근**
```python
# 단어 수준 + 문자 수준 특징 결합
# 원본 문서 이미지도 함께 활용
# 다중 스케일 특징 추출
```

## 📝 결론

csafe_version5_xai_train 데이터는 **MIL 연구에 충분히 활용 가능**하지만, 몇 가지 개선이 필요합니다:

- ✅ **기본적인 MIL 실험**: 현재 상태로도 가능
- ⚠️ **고급 MIL 실험**: 추가 전처리 및 구조 개선 필요
- 💡 **최적 활용**: 원본 문서 데이터와 병행 사용 권장

특히 AB_MIL.md에서 언급된 "단일 인스턴스 교체"로 인한 미미한 차이 문제를 해결하려면, 더 명확한 차이를 만들 수 있는 데이터 구성 전략이 필요합니다.

## 🔍 원본 데이터 구조

### CSAFE 데이터셋 명명 규칙
- **w{작성자ID}**: w0001, w0002 등 (작성자 식별자)
- **s{세션}**: s01, s02, s03 (3개 세션)
- **p{텍스트유형}**: 
  - pWOZ: Wizard of Oz 텍스트
  - pLND: London Letter 텍스트
  - pPHR: Phrase 텍스트
- **r{반복}**: r01, r02, r03 (각 텍스트당 3회 반복)

### 데이터 처리 워크플로우
```
workspace/ (원본 전체 문서 이미지)
    ↓
text_generation.ipynb (EasyOCR 처리)
    ↓
xai_train/ (단어 단위 크롭 이미지)
    ↓
csafe_version5_xai_train/ (최종 버전)
```

## 📊 데이터 활용 전략

### MIL을 위한 Bag 구성 방안

1. **문서 기반 Bag (권장)**
   - 동일 작성자의 동일 반복(문서) = 1 Bag
   - 자연스러운 문서 단위 유지
   - 실제 법의학 시나리오와 유사

2. **세션 기반 Bag**
   - 동일 작성자의 동일 세션 = 1 Bag
   - 시간적 변화 패턴 학습 가능
   - 더 큰 Bag 크기

3. **텍스트 유형 기반 Bag**
   - 동일 작성자의 동일 텍스트 유형 = 1 Bag
   - 콘텐츠별 필기 특성 학습
   - 균형잡힌 Bag 크기

### 복수 필체 문서 시뮬레이션 개선안

현재 AB_MIL 구현에서 단일 인스턴스만 교체하는 것의 한계를 극복하기 위해:

1. **연속된 단어 그룹 교체**
   - 문장 단위로 교체 (5-10개 단어)
   - 더 현실적인 복수 작성자 시나리오

2. **교체 비율 다양화**
   - 10%, 30%, 50% 등 다양한 비율 실험
   - 난이도별 학습 커리큘럼 구성

3. **위치 정보 활용**
   - 문서 내 단어 위치 정보 추가
   - 공간적 패턴 학습 가능

4. **다중 작성자 혼합**
   - 2명 이상의 작성자 필체 혼합
   - 더 복잡한 법의학 시나리오 대응